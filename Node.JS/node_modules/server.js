var server = require('websocket').server, http = require('http');

var socket = new server({
    httpServer: http.createServer().listen(1337, function() {
    	console.log("Server corriendo en puerto 1337")
    })
});

socket.on('request', function(request) {
	console.log('nuevito aqui');
    var connection = request.accept(null, request.origin);
    var count = 0;
	var clients = {};
    var id = 1;

	clients[id] = connection;
	console.log((new Date()) + ' Connection accepted [' + id + ']');
	connection.sendUTF('120, 450');


    connection.on('message', function(message) {

        if (id == 1) {
            var packet = message.utf8Data.split('|');
        var msg = packet[0] || 'MSG_NOOP';
        var x = packet[1] || 0;
        var y = packet[2] || 0;
        switch (msg) {
            case 'MSG_POINT':
                if (x == 120 && y == 450) {
                    connection.send('YAY');
                } else {
                    connection.send('NOPE');
                }
            break;
        }
        }

    });

    connection.on('close', function(connection) {
        console.log('connection closed');
    });
});